{
  "name": "mortgage-compliance-v1",
  "version": "1.0.0",
  "description": "U.S. Mortgage Compliance - Core constraints",
  "constraints": [
    {
      "id": "ATR_QM_DTI",
      "category": "ATR/QM",
      "description": "Debt-to-income ratio requirements",
      "formula_readable": "(dti ≤ 43) ∨ (compensating_factors ≥ 2)",
      "formula": {
        "or": [
          {"<=": ["dti", 43]},
          {">=": ["compensating_factors", 2]}
        ]
      },
      "variables": [
        {"name": "dti", "type": "real"},
        {"name": "compensating_factors", "type": "int"}
      ],
      "error_message": "DTI exceeds 43% without sufficient compensating factors",
      "citation": "12 CFR § 1026.43(c)"
    },
    {
      "id": "HOEPA_HIGH_COST",
      "category": "HOEPA",
      "description": "High-cost mortgage counseling requirement",
      "formula_readable": "(fee_percentage < 8) ∨ counseling_disclosed",
      "formula": {
        "or": [
          {"<": ["fee_percentage", 8]},
          {"==": ["counseling_disclosed", true]}
        ]
      },
      "variables": [
        {"name": "fee_percentage", "type": "real"},
        {"name": "counseling_disclosed", "type": "bool"}
      ],
      "error_message": "HOEPA triggered - counseling disclosure required",
      "citation": "12 CFR § 1026.32"
    },
    {
      "id": "UDAAP_NO_GUARANTEES",
      "category": "UDAAP",
      "description": "Prohibition on guarantee language",
      "formula_readable": "¬has_guarantee",
      "formula": {
        "==": ["has_guarantee", false]
      },
      "variables": [
        {"name": "has_guarantee", "type": "bool"}
      ],
      "error_message": "Cannot use guarantee language for mortgage approvals",
      "citation": "12 CFR § 1036.3"
    },
    {
      "id": "HPML_ESCROW",
      "category": "Escrow",
      "description": "Escrow requirements for higher-priced loans",
      "formula_readable": "¬escrow_waived",
      "formula": {
        "==": ["escrow_waived", false]
      },
      "variables": [
        {"name": "escrow_waived", "type": "bool"}
      ],
      "error_message": "Cannot waive escrow without proper qualification",
      "citation": "12 CFR § 1026.35(b)"
    },
    {
      "id": "REG_B_ADVERSE",
      "category": "Regulation B",
      "description": "Adverse action disclosure requirements",
      "formula_readable": "is_denial → has_specific_reason",
      "formula": {
        "implies": [
          {"==": ["is_denial", true]},
          {"==": ["has_specific_reason", true]}
        ]
      },
      "variables": [
        {"name": "is_denial", "type": "bool"},
        {"name": "has_specific_reason", "type": "bool"}
      ],
      "error_message": "Must disclose specific denial reason",
      "citation": "12 CFR § 1002.9"
    },
    {
      "id": "RATE_EXCEPTION_DOCS",
      "category": "Pricing",
      "description": "Rate exceptions require documentation",
      "formula_readable": "has_rate_exception → has_documentation",
      "formula": {
        "implies": [
          {"==": ["has_rate_exception", true]},
          {"==": ["has_documentation", true]}
        ]
      },
      "variables": [
        {"name": "has_rate_exception", "type": "bool"},
        {"name": "has_documentation", "type": "bool"}
      ],
      "error_message": "Rate exceptions require proper documentation",
      "citation": "Internal Policy - Fair Lending"
    },
    {
      "id": "QM_NO_INTEREST_ONLY",
      "category": "ATR/QM",
      "description": "Interest-only loans not permitted for QM",
      "formula_readable": "¬is_interest_only",
      "formula": {
        "==": ["is_interest_only", false]
      },
      "variables": [
        {"name": "is_interest_only", "type": "bool"}
      ],
      "error_message": "Interest-only loans do not qualify as QM",
      "citation": "12 CFR § 1026.43(e)(2)"
    },
    {
      "id": "UDAAP_DOCUMENTED_PRICING",
      "category": "UDAAP",
      "description": "Pricing must be documented and on record",
      "formula_readable": "¬is_off_books",
      "formula": {
        "==": ["is_off_books", false]
      },
      "variables": [
        {"name": "is_off_books", "type": "bool"}
      ],
      "error_message": "All pricing must be documented - no off-books deals",
      "citation": "UDAAP - Fair Lending"
    }
  ],
  "extractors": {
    "dti": {
      "type": "float",
      "pattern": "dti[:\\s~]*(\\d+(?:\\.\\d+)?)"
    },
    "credit_score": {
      "type": "int",
      "pattern": "(?:fico|credit score)[:\\s]*(\\d{3})"
    },
    "fee_percentage": {
      "type": "float",
      "pattern": "(\\d+\\.?\\d*)%"
    },
    "has_guarantee": {
      "type": "boolean",
      "keywords": ["guaranteed", "100%", "definitely", "never turn", "always approve"]
    },
    "counseling_disclosed": {
      "type": "boolean",
      "keywords": ["counseling required", "counseling needed", "must complete counseling"],
      "negation_words": ["no counseling"],
      "check_negation": true
    },
    "escrow_waived": {
      "type": "boolean",
      "keywords": ["escrow waived", "waive escrow", "skip escrow", "no escrow"]
    },
    "is_denial": {
      "type": "boolean",
      "keywords": ["denied", "cannot approve", "cant approve", "not approved", "decline", "unable to approve"]
    },
    "has_specific_reason": {
      "type": "boolean",
      "keywords": ["credit", "income", "dti", "debt", "score", "employment", "assets", "collateral"]
    },
    "has_rate_exception": {
      "type": "boolean",
      "keywords": ["dropping your rate", "rate buydown", "rate exception", "rate reduction", "lower rate", "discount rate"]
    },
    "has_documentation": {
      "type": "boolean",
      "keywords": ["documentation", "paperwork", "documents", "documented", "on record"],
      "negation_words": ["no paperwork", "no documentation", "no documents", "without paperwork", "without documentation"],
      "check_negation": true
    },
    "is_interest_only": {
      "type": "boolean",
      "keywords": ["interest-only", "interest only", "io loan"]
    },
    "is_off_books": {
      "type": "boolean",
      "keywords": ["off the books", "off-the-books", "dont tell", "between us", "special deal", "secret"]
    }
  }
}
